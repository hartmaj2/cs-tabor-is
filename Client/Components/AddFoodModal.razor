@using Shared

<EditForm Model="@mealFormData" OnValidSubmit="()=>Console.WriteLine(42)">
    <DataAnnotationsValidator/>
    <ValidationSummary/>

    <div>
        <label for="meal-name" > Meal name: </label> <br/>
        <InputText id="meal-name" @bind-Value="mealFormData.Name"/> <br/>
        <ValidationMessage For="() => mealFormData.Name" />
        <br/> 
    </div>

    <div>
        <label> Meal type: </label> <br/>
        <InputRadioGroup @bind-Value="mealFormData.MealType">
            @foreach (var mealType in MealTypes!)
            {
                <InputRadio id="@mealType" Value="@mealType" /> <label for="@mealType"> @mealType </label> <br/>
                @* <input name="meal-type" " type="radio" @onchange="() => mealFormData.MealType = mealType">  *@
            }
        </InputRadioGroup>
        <ValidationMessage For="() => mealFormData.MealType" />
        <br/>
    </div>

    <div>
        <label> Allergens: </label> <br/>
        @foreach (var allergenSelection in mealFormData.AllergenSelections!)
        {
            <InputCheckbox id="@allergenSelection.Name" type="checkbox" @bind-Value="allergenSelection.IsSelected" /> <label for="@allergenSelection.Name"> @allergenSelection.Name </label> <br/>
        }
    </div>

    <button type="submit" class="btn btn-primary"> Add meal </button>

</EditForm>

<p> Selected meal type: @mealFormData.MealType</p>
<span> Selected allergens: </span>
@foreach (var selected in mealFormData.AllergenSelections!.Where(selection => selection.IsSelected))
{
    <span> @selected.Name </span>
}

@code
{
    private MealFormData mealFormData = new();

    [Parameter]
    public IEnumerable<Allergen>? AllAllergens { get; set; }

    [Parameter]
    public IEnumerable<string>? MealTypes { get; set; }

    protected override void OnInitialized()
    {
        mealFormData.AllergenSelections = AllAllergens!.Select(allergen => new MealFormData.AllergenSelection() {Name = allergen.Name}).ToList();
    }
}